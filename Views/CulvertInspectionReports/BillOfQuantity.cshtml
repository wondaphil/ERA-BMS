@using ERA_BMS.Models
@using ERA_BMS.ViewModels

@{
    ViewBag.Title = "Culvert BOQ";
}

<h2 align="center">Culvert Bill of Quantity (BOQ)</h2>

<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title panel-info">Culvert Bill of Quantity - BOQ (District: <b>@ViewBag.District</b>, Section: <b>@ViewBag.Section</b>, Road Segment: <b>@ViewBag.Segment</b>, Culvert: <b>@ViewBag.CulvertNo</b>)</h3>
    </div>

    <div class="panel-body">
        <br />
        <table class="table table-striped table-condensed table-responsive table-bordered display compact hover" id="billofquantity">
            <thead>
                <tr><th colspan="10" align="center">CULVERT</th></tr>
                <tr>
                    <th>Structure Items</th>
                    <th>Damage Type</th>
                    <th>Unit</th>
                    <th>Qty</th>
                    <th>Unit Repair Cost</th>
                    <th>Total Repair Cost</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>

                @{
                    var totCcost = 0.0;
                }
                @for (int i = 0; i < ViewBag.CulvertStructure.Count; i++)
                {
                    var strItemCost = 0.0;

                    for (int j = 0; j < ViewBag.CulvertStructure[i].Count; j++)
                    {
                        // If Quantity = 0, then exit from inner loop (damage type) and go to outer loop (structure item)
                        if (ViewBag.CulvertStructure[i][j].Quantity == 0)
                        {
                            break;
                        }
                        <tr>
                            <td>
                                @{ var strItemName = "";
                                    if (j == 0)
                                    {
                                        strItemName = ViewBag.CulvertStructure[i][j].culDamageRateAndCost.StructureItemId + " " + ViewBag.CulvertStructure[i][j].culDamageRateAndCost.culStructureItem.StructureItemName;
                                    }
                                }
                                <b>@strItemName</b>
                            </td>
                            <td>
                                @ViewBag.CulvertStructure[i][j].culDamageRateAndCost.DamageTypeName
                            </td>
                            <td>
                                @{ var index = ViewBag.CulvertStructure[i][j].culDamageRateAndCost.Id;
                                }
                                @ViewBag.DamageRateCulvert[i][index - 1].Unit
                            </td>
                            <td>
                                @{ var dmgArea = ViewBag.CulvertStructure[i][j].Quantity;
                                }
                                @dmgArea.ToString("0.00")  @*format it to two decimal places*@
                            </td>
                            <td>
                                @ViewBag.DamageRateCulvert[i][index - 1].UnitRepairCost.ToString("#,0.00")
                            </td>
                            <td>
                                @{ var cost = ViewBag.DamageRateCulvert[i][index - 1].UnitRepairCost * ViewBag.CulvertStructure[i][j].Quantity;
                                    strItemCost += cost;
                                }

                                @cost.ToString("#,0.00")
                            </td>
                        </tr>
                    }
                    // If cost of structure item is zero, skip the entire row
                    if (strItemCost != 0)
                    {
                        <tr>
                            <td colspan="5"></td>
                            <td><b>@strItemCost.ToString("#,0.00")</b></td>
                            @{
                                totCcost += strItemCost;
                            }
                        </tr>
                    }
                }

                <tr>
                    <td class="panel-title" colspan="5" align="right">Total Repair Cost for Culvert '<i>@ViewBag.CulvertId</i>'</td>
                    @{
                        double culvertCost = totCcost;
                    }

                    <td class="panel-title"><b>@culvertCost.ToString("#,0.00")</b></td>
                </tr>
            </tbody>

        </table>
    </div>
    <div class="panel-footer">
        <h5>Bill of Quantity (BOQ) for Culvert Repair (<b>@ViewBag.CulvertId</b>)</h5>
    </div>
</div>

<script>
    $(document).ready(function () {
        

        $('#billofquantity').dataTable({
            paging: true,
            pageLength: 15,
            bLengthChange: true,
            scrollY: 400,
            
            searching: true,
            select: true,
            dom: 'lBfrtip',
            //buttons: ['copy', 'excel', 'pdf', 'print']
            buttons: [
                { extend: 'copy', className: 'btn btn-sm btn-primary' },
                { extend: 'excel', className: 'btn btn-sm btn-primary', text: 'Export Excel' },
                { extend: 'pdf', className: 'btn btn-sm btn-primary', text: 'Export PDF' },
                { extend: 'print', className: 'btn btn-sm btn-primary' }
            ]
        });
    });
</script>

