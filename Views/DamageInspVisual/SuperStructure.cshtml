@model ERA_BMS.ViewModels.InspVisualSuperStructuresViewModel

<!--Change TempData to ViewBag for easy use-->
@{
    ViewBag.DeckSlabDamageTypeList = (List<string[]>)TempData["DeckSlabDamageTypeList"];
    ViewBag.ConcreteGirderDamageTypeList = (List<string[]>)TempData["ConcreteGirderDamageTypeList"];
    ViewBag.SteelTrussGirderDamageTypeList = (List<string[]>)TempData["SteelTrussGirderDamageTypeList"];

    ViewBag.DamageSeverity = (List<SelectListItem>)TempData["DamageSeverity"];
}

<input type="hidden" id="bridgeId" value="@TempData["BridgeId"]" /> <!-- Bridge Id -->
<input type="hidden" id="inspectionDate" value="@TempData["InspectionDate"]" /> <!-- Inspection Date -->
<div class="row">
    <div class="panel panel-default panel-collapse col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-1">
            <h5 class="panel-title panel-info" style="text-align: center">Deck Slab</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblDeckSlab" style="border: 1px solid black;">
                <tr id="heading-1">
                    <th></th>
                    <th>DamageType</th>
                    <th>DamageLevel</th>
                    <th></th>
                    <th></th>
                </tr>

                @foreach (var item in Model.DeckSlab)
                {
                    <tr>
                        <td>
                            <input type="hidden" id="DeckSlabId" value="@item.Id" /> <!-- Unique Id of Damage Inspection Visual -->
                        </td>
                        <td>
                            <span class="damage-type-deckslab" name="@item.Id">@item.DamageType.DamageTypeName</span>
                        </td>
                        <td>
                            <span class="damage-severity" name="@item.Id">@item.DamageSeverity.DamageSeverityName</span>
                        </td>
                        <td>
                            <a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a>
                        </td>
                        <td>
                            <a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>
                            <a class="Delete glyphicon glyphicon-trash" href="javascript:;" data-toggle="tooltip" title="Delete"></a>
                        </td>
                    </tr>
                }
            </table>

            <table>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Type:<br />
                        @Html.DropDownList("ddlDeckSlabDamageType", (List<SelectListItem>)TempData["DamageType5"])
                    </td>
                </tr>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Level:<br />
                        @Html.DropDownList("ddlDeckSlabDamageLevel", (List<SelectListItem>)ViewBag.DamageSeverity)
                    </td>
                </tr>
                <tr>
                    <td style="width: 200px">
                        <br />
                        <button type="button" id="btnSaveDeckSlabDamage" class="btn btn-primary"><span class="glyphicon glyphicon-save"></span> Save</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="panel panel-default col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-2">
            <h5 class="panel-title panel-info" style="text-align: center">Concrete Girder</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblConcreteGirder" style="border: 1px solid black;">
                <tr id="heading-2">
                    <th></th>
                    <th>DamageType</th>
                    <th>DamageLevel</th>
                    <th></th>
                    <th></th>
                </tr>

                @foreach (var item in Model.ConcreteGirder)
                {
                    <tr>
                        <td>
                            <input type="hidden" id="ConcreteGirderId" value="@item.Id" /> <!-- Unique Id of Damage Inspection Visual -->
                        </td>
                        <td>
                            <span class="damage-type-concretegirder" name="@item.Id">@item.DamageType.DamageTypeName</span>
                        </td>
                        <td>
                            <span class="damage-severity" name="@item.Id">@item.DamageSeverity.DamageSeverityName</span>
                        </td>
                        <td>
                            <a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a>
                        </td>
                        <td>
                            <a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>
                            <a class="Delete glyphicon glyphicon-trash" href="javascript:;" data-toggle="tooltip" title="Delete"></a>
                        </td>
                    </tr>
                }
            </table>

            <table>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Type:<br />
                        @Html.DropDownList("ddlConcreteGirderDamageType", (List<SelectListItem>)TempData["DamageType6"])
                    </td>
                </tr>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Level:<br />
                        @Html.DropDownList("ddlConcreteGirderDamageLevel", (List<SelectListItem>)ViewBag.DamageSeverity)
                    </td>
                </tr>
                <tr>
                    <td style="width: 200px">
                        <br />
                        <button type="button" id="btnSaveConcreteGirderDamage" class="btn btn-primary"><span class="glyphicon glyphicon-save"></span> Save</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="clearfix visible-xs"></div> <!-- Add clearfix (or new line break) for only the xs -->

    <div class="panel panel-default col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-1">
            <h5 class="panel-title panel-info" style="text-align: center">Steel Truss/Girder</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblSteelTrussGirder" style="border: 1px solid black;">
                <tr id="heading-1">
                    <th></th>
                    <th>DamageType</th>
                    <th>DamageLevel</th>
                    <th></th>
                    <th></th>
                </tr>

                @foreach (var item in Model.SteelTrussGirder)
                {
                    <tr>
                        <td>
                            <input type="hidden" id="SteelTrussGirderId" value="@item.Id" /> <!-- Unique Id of Damage Inspection Visual -->
                        </td>
                        <td>
                            <span class="damage-type-steeltrussgirder" name="@item.Id">@item.DamageType.DamageTypeName</span>
                        </td>
                        <td>
                            <span class="damage-severity" name="@item.Id">@item.DamageSeverity.DamageSeverityName</span>
                        </td>
                        <td>
                            <a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a>
                        </td>
                        <td>
                            <a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>
                            <a class="Delete glyphicon glyphicon-trash" href="javascript:;" data-toggle="tooltip" title="Delete"></a>
                        </td>
                    </tr>
                }
            </table>

            <table>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Type:<br />
                        @Html.DropDownList("ddlSteelTrussGirderDamageType", (List<SelectListItem>)TempData["DamageType7"])
                    </td>
                </tr>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Level:<br />
                        @Html.DropDownList("ddlSteelTrussGirderDamageLevel", (List<SelectListItem>)ViewBag.DamageSeverity)
                    </td>
                </tr>
                <tr>
                    <td style="width: 200px">
                        <br />
                        <button type="button" id="btnSaveSteelTrussGirderDamage" class="btn btn-primary"><span class="glyphicon glyphicon-save"></span> Save</button>
                    </td>
            </table>
        </div>
    </div>
</div>

@*<div id="status"></div>*@

<script type="text/javascript">
    $(document).ready(function () {
        makeDamageLevelEditable();
        makeDeckSlabDamageEditable();
        makeConcreteGirderDamageEditable();
        makeSteelTrussGirderDamageEditable();

        // A function that makes "DamageLevel" editable
        function makeDamageLevelEditable() {
            $(".damage-severity").each(function () {
                var selVisualInspId = $(this).attr("name");
                $(this).editable("/DamageInspVisual/UpdateDamageSeverity", {
                    type: "select",
                    loadurl: '/DamageInspVisual/SelectDamageSeverity',
                    callback: function (value, settings) {
                        $(this).html(jQuery.parseJSON(settings.data)[value]);
                    },
                    submitdata: function () {
                        return {
                            id: selVisualInspId,
                            @*inspdate: '@TempData["InspectionDate"]'*@
                        };
                    },
                    tooltip: 'Click me...',
                    indicator: 'Saving...',
                    size: 10
                });
            });
        }

        // A function that makes Deck Slab "DamageType" editable
        function makeDeckSlabDamageEditable() {
            $(".damage-type-deckslab").each(function () {
                var selVisualInspId = $(this).attr("name");
                $(this).editable('/DamageInspVisual/UpdateDamageType', {
                    type: "select",
                    loadurl: '/DamageInspVisual/SelectDamageTypeDeckSlab',
                    callback: function (value, settings) {
                        $(this).html(jQuery.parseJSON(settings.data)[value]);
                    },
                    submitdata: function () {
                        return {
                            id: selVisualInspId,
                            @*inspdate: '@TempData["InspectionDate"]'*@
                        };
                    },
                    tooltip: 'Click/Tap to edit...',
                    indicator: 'Saving...'
                });
            });
        }

        // A function that makes Concrete Girder "DamageType" editable
        function makeConcreteGirderDamageEditable() {
            $(".damage-type-concretegirder").each(function () {
                var selVisualInspId = $(this).attr("name");
                $(this).editable('/DamageInspVisual/UpdateDamageType', {
                    type: "select",
                    loadurl: '/DamageInspVisual/SelectDamageTypeConcreteGirder',
                    callback: function (value, settings) {
                        $(this).html(jQuery.parseJSON(settings.data)[value]);
                    },
                    submitdata: function () {
                        return {
                            id: selVisualInspId,
                            @*inspdate: '@TempData["InspectionDate"]'*@
                        };
                    },
                    tooltip: 'Click/Tap to edit...',
                    indicator: 'Saving...'
                });
            });
        }

        // A function that makes Steel Truss Girder "DamageType" editable
        function makeSteelTrussGirderDamageEditable() {
            $(".damage-type-steeltrussgirder").each(function () {
                var selVisualInspId = $(this).attr("name");
                $(this).editable('/DamageInspVisual/UpdateDamageType', {
                    type: "select",
                    loadurl: '/DamageInspVisual/SelectDamageTypeSteelTrussGirder',
                    callback: function (value, settings) {
                        $(this).html(jQuery.parseJSON(settings.data)[value]);
                    },
                    submitdata: function () {
                        return {
                            id: selVisualInspId,
                            @*inspdate: '@TempData["InspectionDate"]'*@
                        };
                    },
                    tooltip: 'Click/Tap to edit...',
                    indicator: 'Saving...'
                });
            });
        }

        //Save Deck Slab Damage
        $("#btnSaveDeckSlabDamage").on("click", function () {
            //alert("Hello");
            var BridgeId = $("#bridgeId");
            var InspectionDate = $("#inspectionDate");
            var DeckSlabDamageType = $("#ddlDeckSlabDamageType");
            var DeckSlabDamageLevel = $("#ddlDeckSlabDamageLevel");
            var InspType = 1;
            var StructItem = 5;
            //alert('{BridgeId: "' + BridgeId.val() + '", StructureItemId: ' + StructItem + ', DamageTypeId: ' + DeckSlabDamageType.val() + ', DamageSeverityId: ' + DeckSlabDamageLevel.val() + ', InspectionTypeId: ' + InspType + ', InspectionDate: "' + InspectionDate.val() + '" }');
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SaveDamage", "DamageInspVisual")',
                data: '{BridgeId: "' + BridgeId.val() + '", StructureItemId: ' + StructItem + ', DamageTypeId: ' + DeckSlabDamageType.val() + ', DamageSeverityId: ' + DeckSlabDamageLevel.val() + ', InspectionTypeId: ' + InspType + ', InspectionDate: "' + InspectionDate.val() + '" }',
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Action("GetLastAddedDamage", "DamageInspVisual")',
                        data: { bridgeid: BridgeId.val() },
                        datatype: 'json',
                        success: function (data) {
                            var Id = data.Id;
                            var row = '<tr>';
                            row += '<td><input type="hidden" id="DeckSlabId" value="' + Id + '" /></td>';
                            row += '<td><span class="damage-type-deckslab" name="' + Id + '">' + $('#ddlDeckSlabDamageType option:selected').text() + '</span></td>';
                            row += '<td><span class="damage-severity" name="' + Id + '">' + $('#ddlDeckSlabDamageLevel option:selected').text() + '</span></td>';
                            row += '<td><a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a></td>';
                            row += '<td><a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>'
                                + '<a class="Delete glyphicon glyphicon-trash" href = "javascript:;" data - toggle="tooltip" title = "Delete" ></a ></td>';
                            row += '</tr > ';
                            $("#tblDeckSlab > tbody").append(row);
                            makeDeckSlabDamageEditable();
                            //alert(row);
                            makeDamageLevelEditable();
                            $('#ddlDeckSlabDamageType').val("");
                            $('#ddlDeckSlabDamageLevel').val("");
                        },
                        error: function (xhr) {
                            //$('#status').text(xhr.status);
                        }
                    });
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Cancel Deck Slab damage
        $("body").on("click", "#tblDeckSlab .Cancel", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {
                if ($(this).find("input").length > 0) {
                    var span = $(this).find("span");
                    var input = $(this).find("input");
                    input.val(span.html());
                    span.show();
                    input.hide();
                }
            });
            row.find(".Delete").show();
            row.find(".Confirm").hide();
            $(this).hide();
        });

        //Delete Deck Slab damage
        $("body").on("click", "#tblDeckSlab .Delete", function () {
            var row = $(this).closest("tr");
            row.find(".Confirm").show();
            row.find(".Cancel").show();
            row.find(".Delete").hide();
            $(this).hide();
        });

        //Confirm Deck Slab damage
        $("body").on("click", "#tblDeckSlab .Confirm", function () {
            var row = $(this).closest("tr");
            var id = row.find('#DeckSlabId').val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteDamage", "DamageInspVisual")',
                data: '{id: "' + id + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                success: function (response) {
                    if ($("#tblDeckSlab tr").length > 2) {
                        row.remove();

                    } else {
                        row.find(".Delete").hide();
                        row.find(".Confirm").hide();
                        row.find(".Cancel").hide();
                        row.find("span").html('&nbsp;');
                    }
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Save Concrete Girder Damage
        $("#btnSaveConcreteGirderDamage").on("click", function () {
            var BridgeId = $("#bridgeId");
            var InspectionDate = $("#inspectionDate");
            var ConcreteGirderDamageType = $("#ddlConcreteGirderDamageType");
            var ConcreteGirderDamageLevel = $("#ddlConcreteGirderDamageLevel");
            var InspType = 1;
            var StructItem = 6;
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SaveDamage", "DamageInspVisual")',
                data: '{BridgeId: "' + BridgeId.val() + '", StructureItemId: ' + StructItem + ', DamageTypeId: ' + ConcreteGirderDamageType.val() + ', DamageSeverityId: ' + ConcreteGirderDamageLevel.val() + ', InspectionTypeId: ' + InspType + ', InspectionDate: "' + InspectionDate.val() + '" }',
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Action("GetLastAddedDamage", "DamageInspVisual")',
                        data: { bridgeid: BridgeId.val() },
                        datatype: 'json',
                        success: function (data) {
                            var Id = data.Id;
                            var row = '<tr>';
                            row += '<td><input type="hidden" id="ConcreteGirderId" value="' + Id + '" /></td>';
                            row += '<td><span class="damage-type-concretegirder" name="' + Id + '">' + $('#ddlConcreteGirderDamageType option:selected').text() + '</span></td>';
                            row += '<td><span class="damage-severity" name="' + Id + '">' + $('#ddlConcreteGirderDamageLevel option:selected').text() + '</span></td>';
                            row += '<td><a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a></td>';
                            row += '<td><a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>'
                                + '<a class="Delete glyphicon glyphicon-trash" href = "javascript:;" data - toggle="tooltip" title = "Delete" ></a ></td>';
                            row += '</tr > ';
                            //alert(row);
                            $("#tblConcreteGirder > tbody").append(row);
                            makeConcreteGirderDamageEditable();
                            makeDamageLevelEditable();
                            $('#ddlConcreteGirderDamageType').val("");
                            $('#ddlConcreteGirderDamageLevel').val("");
                        },
                        error: function (xhr) {
                            //$('#status').text(xhr.status);
                        }
                    });
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Cancel Concrete Girder damage
        $("body").on("click", "#tblConcreteGirder .Cancel", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {
                if ($(this).find("input").length > 0) {
                    var span = $(this).find("span");
                    var input = $(this).find("input");
                    input.val(span.html());
                    span.show();
                    input.hide();
                }
            });
            row.find(".Delete").show();
            row.find(".Confirm").hide();
            $(this).hide();
        });

        //Delete Concrete Girder damage
        $("body").on("click", "#tblConcreteGirder .Delete", function () {
            var row = $(this).closest("tr");
            row.find(".Confirm").show();
            row.find(".Cancel").show();
            row.find(".Delete").hide();
            $(this).hide();
        });

        //Confirm Concrete Girder damage
        $("body").on("click", "#tblConcreteGirder .Confirm", function () {
            var row = $(this).closest("tr");
            var id = row.find('#ConcreteGirderId').val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteDamage", "DamageInspVisual")',
                data: '{id: "' + id + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                success: function (response) {
                    if ($("#tblConcreteGirder tr").length > 2) {
                        row.remove();

                    } else {
                        row.find(".Delete").hide();
                        row.find(".Confirm").hide();
                        row.find(".Cancel").hide();
                        row.find("span").html('&nbsp;');
                    }
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Save Steel Truss Girder Damage
        $("#btnSaveSteelTrussGirderDamage").on("click", function () {
            var BridgeId = $("#bridgeId");
            var InspectionDate = $("#inspectionDate");
            var SteelTrussGirderDamageType = $("#ddlSteelTrussGirderDamageType");
            var SteelTrussGirderDamageLevel = $("#ddlSteelTrussGirderDamageLevel");
            var InspType = 1;
            var StructItem = 7;
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SaveDamage", "DamageInspVisual")',
                data: '{BridgeId: "' + BridgeId.val() + '", StructureItemId: ' + StructItem + ', DamageTypeId: ' + SteelTrussGirderDamageType.val() + ', DamageSeverityId: ' + SteelTrussGirderDamageLevel.val() + ', InspectionTypeId: ' + InspType + ', InspectionDate: "' + InspectionDate.val() + '" }',
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Action("GetLastAddedDamage", "DamageInspVisual")',
                        data: { bridgeid: BridgeId.val() },
                        datatype: 'json',
                        success: function (data) {
                            var Id = data.Id;
                            var row = '<tr>';
                            row += '<td><input type="hidden" id="SteelTrussGirderId" value="' + Id + '" /></td>';
                            row += '<td><span class="damage-type-steeltrussgirder" name="' + Id + '">' + $('#ddlSteelTrussGirderDamageType option:selected').text() + '</span></td>';
                            row += '<td><span class="damage-severity" name="' + Id + '">' + $('#ddlSteelTrussGirderDamageLevel option:selected').text() + '</span></td>';
                            row += '<td><a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a></td>';
                            row += '<td><a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>'
                                + '<a class="Delete glyphicon glyphicon-trash" href = "javascript:;" data - toggle="tooltip" title = "Delete" ></a ></td>';
                            row += '</tr > ';
                            //alert(row);
                            $("#tblSteelTrussGirder > tbody").append(row);
                            makeSteelTrussGirderDamageEditable();
                            makeDamageLevelEditable();
                            $('#ddlSteelTrussGirderDamageType').val("");
                            $('#ddlSteelTrussGirderDamageLevel').val("");
                        },
                        error: function (xhr) {
                            //$('#status').text(xhr.status);
                        }
                    });
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Cancel Steel Truss Girder damage
        $("body").on("click", "#tblSteelTrussGirder .Cancel", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {
                if ($(this).find("input").length > 0) {
                    var span = $(this).find("span");
                    var input = $(this).find("input");
                    input.val(span.html());
                    span.show();
                    input.hide();
                }
            });
            row.find(".Delete").show();
            row.find(".Confirm").hide();
            $(this).hide();
        });

        //Delete Steel Truss Girder damage
        $("body").on("click", "#tblSteelTrussGirder .Delete", function () {
            var row = $(this).closest("tr");
            row.find(".Confirm").show();
            row.find(".Cancel").show();
            row.find(".Delete").hide();
            $(this).hide();
        });

        //Confirm Steel Truss Girder damage
        $("body").on("click", "#tblSteelTrussGirder .Confirm", function () {
            var row = $(this).closest("tr");
            var id = row.find('#SteelTrussGirderId').val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteDamage", "DamageInspVisual")',
                data: '{id: "' + id + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                success: function (response) {
                    if ($("#tblSteelTrussGirder tr").length > 2) {
                        row.remove();

                    } else {
                        row.find(".Delete").hide();
                        row.find(".Confirm").hide();
                        row.find(".Cancel").hide();
                        row.find("span").html('&nbsp;');
                    }
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });
    });
</script>
