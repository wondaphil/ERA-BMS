@model ERA_BMS.ViewModels.InspVisualAncillariesViewModel

<!--Change TempData to ViewBag for easy use-->
@{
    ViewBag.PavementDamageTypeList = (List<string[]>)TempData["PavementDamageTypeList"];
    ViewBag.CurbAndRailingDamageTypeList = (List<string[]>)TempData["CurbAndRailingDamageTypeList"];
    ViewBag.DrainageDamageTypeList = (List<string[]>)TempData["DrainageDamageTypeList"];
    ViewBag.BearingDamageTypeList = (List<string[]>)TempData["BearingDamageTypeList"];
    ViewBag.ExpansionJointDamageTypeList = (List<string[]>)TempData["ExpansionJointDamageTypeList"];

    ViewBag.DamageSeverity = (List<SelectListItem>)TempData["DamageSeverity"];
}

<input type="hidden" id="bridgeId" value="@TempData["BridgeId"]" /> <!-- Bridge Id -->
<input type="hidden" id="inspectionDate" value="@TempData["InspectionDate"]" /> <!-- Inspection Date -->
<div class="row">
    <div class="panel panel-default col-lg-15 col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-1">
            <h5 class="panel-title panel-info" style="text-align: center">Pavement</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblPavement" style="border: 1px solid black;">
                <tr id="heading-1">
                    <th></th>
                    <th>Damage Type</th>
                    <th>Damage Level</th>
                    <th></th>
                    <th></th>
                </tr>

                @foreach (var item in Model.Pavement)
                {
                    <tr>
                        <td>
                            <input type="hidden" id="PavementId" value="@item.Id" /> <!-- Unique Id of Damage Inspection Visual -->
                        </td>
                        <td>
                            <span class="damage-type-pavement" name="@item.Id">@item.DamageType.DamageTypeName</span>
                        </td>
                        <td>
                            <span class="damage-severity" name="@item.Id">@item.DamageSeverity.DamageSeverityName</span>
                        </td>
                        <td>
                            <a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a>
                        </td>
                        <td>
                            <a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>
                            <a class="Delete glyphicon glyphicon-trash" href="javascript:;" data-toggle="tooltip" title="Delete"></a>
                        </td>
                    </tr>
                }
            </table>

            <table>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Type:<br />
                        @Html.DropDownList("ddlPavementDamageType", (List<SelectListItem>)TempData["DamageType8"])
                    </td>
                </tr>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Level:<br />
                        @Html.DropDownList("ddlPavementDamageLevel", (List<SelectListItem>)ViewBag.DamageSeverity)
                    </td>
                </tr>
                <tr>
                    <td style="width: 200px">
                        <br />
                        <button type="button" id="btnSavePavementDamage" class="btn btn-primary"><span class="glyphicon glyphicon-save"></span> Save</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="panel panel-default col-lg-15 col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-2">
            <h5 class="panel-title panel-info" style="text-align: center">Curb and Railing</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblCurbAndRailing" style="border: 1px solid black;">
                <tr id="heading-2">
                    <th></th>
                    <th>Damage Type</th>
                    <th>Damage Level</th>
                    <th></th>
                    <th></th>
                </tr>

                @foreach (var item in Model.CurbAndRailing)
                {
                    <tr>
                        <td>
                            <input type="hidden" id="CurbAndRailingId" value="@item.Id" /> <!-- Unique Id of Damage Inspection Visual -->
                        </td>
                        <td>
                            <span class="damage-type-curbandrailing" name="@item.Id">@item.DamageType.DamageTypeName</span>
                        </td>
                        <td>
                            <span class="damage-severity" name="@item.Id">@item.DamageSeverity.DamageSeverityName</span>
                        </td>
                        <td>
                            <a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a>
                        </td>
                        <td>
                            <a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>
                            <a class="Delete glyphicon glyphicon-trash" href="javascript:;" data-toggle="tooltip" title="Delete"></a>
                        </td>
                    </tr>
                }
            </table>

            <table>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Type:<br />
                        @Html.DropDownList("ddlCurbAndRailingDamageType", (List<SelectListItem>)TempData["DamageType9"])
                    </td>
                </tr>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Level:<br />
                        @Html.DropDownList("ddlCurbAndRailingDamageLevel", (List<SelectListItem>)ViewBag.DamageSeverity)
                    </td>
                </tr>
                <tr>
                    <td style="width: 200px">
                        <br />
                        <button type="button" id="btnSaveCurbAndRailingDamage" class="btn btn-primary"><span class="glyphicon glyphicon-save"></span> Save</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="clearfix visible-xs"></div> <!-- Add clearfix (or new line break) for only the xs -->

    <div class="panel panel-default col-lg-15 col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-1">
            <h5 class="panel-title panel-info" style="text-align: center">Drainage</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblDrainage" style="border: 1px solid black;">
                <tr id="heading-1">
                    <th></th>
                    <th>Damage Type</th>
                    <th>Damage Level</th>
                    <th></th>
                    <th></th>
                </tr>

                @foreach (var item in Model.Drainage)
                {
                    <tr>
                        <td>
                            <input type="hidden" id="DrainageId" value="@item.Id" /> <!-- Unique Id of Damage Inspection Visual -->
                        </td>
                        <td>
                            <span class="damage-type-drainage" name="@item.Id">@item.DamageType.DamageTypeName</span>
                        </td>
                        <td>
                            <span class="damage-severity" name="@item.Id">@item.DamageSeverity.DamageSeverityName</span>
                        </td>
                        <td>
                            <a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a>
                        </td>
                        <td>
                            <a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>
                            <a class="Delete glyphicon glyphicon-trash" href="javascript:;" data-toggle="tooltip" title="Delete"></a>
                        </td>
                    </tr>
                }
            </table>

            <table>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Type:<br />
                        @Html.DropDownList("ddlDrainageDamageType", (List<SelectListItem>)TempData["DamageType10"])
                    </td>
                </tr>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Level:<br />
                        @Html.DropDownList("ddlDrainageDamageLevel", (List<SelectListItem>)ViewBag.DamageSeverity)
                    </td>
                </tr>
                <tr>
                    <td style="width: 200px">
                        <br />
                        <button type="button" id="btnSaveDrainageDamage" class="btn btn-primary"><span class="glyphicon glyphicon-save"></span> Save</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="clearfix visible-sm"></div> <!-- Add clearfix (or new line break) for only the sm -->

    <div class="panel panel-default col-lg-15 col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-2">
            <h5 class="panel-title panel-info" style="text-align: center">Bearing</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblBearing" style="border: 1px solid black;">
                <tr id="heading-2">
                    <th></th>
                    <th>Damage Type</th>
                    <th>Damage Level</th>
                    <th></th>
                    <th></th>
                </tr>

                @foreach (var item in Model.Bearing)
                {
                    <tr>
                        <td>
                            <input type="hidden" id="BearingId" value="@item.Id" /> <!-- Unique Id of Damage Inspection Visual -->
                        </td>
                        <td>
                            <span class="damage-type-bearing" name="@item.Id">@item.DamageType.DamageTypeName</span>
                        </td>
                        <td>
                            <span class="damage-severity" name="@item.Id">@item.DamageSeverity.DamageSeverityName</span>
                        </td>
                        <td>
                            <a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a>
                        </td>
                        <td>
                            <a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>
                            <a class="Delete glyphicon glyphicon-trash" href="javascript:;" data-toggle="tooltip" title="Delete"></a>
                        </td>
                    </tr>
                }
            </table>

            <table>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Type:<br />
                        @Html.DropDownList("ddlBearingDamageType", (List<SelectListItem>)TempData["DamageType11"])
                    </td>
                </tr>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Level:<br />
                        @Html.DropDownList("ddlBearingDamageLevel", (List<SelectListItem>)ViewBag.DamageSeverity)
                    </td>
                </tr>
                <tr>
                    <td style="width: 200px">
                        <br />
                        <button type="button" id="btnSaveBearingDamage" class="btn btn-primary"><span class="glyphicon glyphicon-save"></span> Save</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="clearfix visible-md"></div> <!-- Add clearfix (or new line break) for only the md -->
    <div class="clearfix visible-xs"></div> <!-- Add clearfix (or new line break) for only the xs -->

    <div class="panel panel-default col-lg-15 col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-1">
            <h5 class="panel-title panel-info" style="text-align: center">Expansion Joint</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblExpansionJoint" style="border: 1px solid black;">
                <tr id="heading-1">
                    <th></th>
                    <th>Damage Type</th>
                    <th>Damage Level</th>
                    <th></th>
                    <th></th>
                </tr>

                @foreach (var item in Model.ExpansionJoint)
                {
                    <tr>
                        <td>
                            <input type="hidden" id="ExpansionJointId" value="@item.Id" /> <!-- Unique Id of Damage Inspection Visual -->
                        </td>
                        <td>
                            <span class="damage-type-expansionjoint" name="@item.Id">@item.DamageType.DamageTypeName</span>
                        </td>
                        <td>
                            <span class="damage-severity" name="@item.Id">@item.DamageSeverity.DamageSeverityName</span>
                        </td>
                        <td>
                            <a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a>
                        </td>
                        <td>
                            <a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>
                            <a class="Delete glyphicon glyphicon-trash" href="javascript:;" data-toggle="tooltip" title="Delete"></a>
                        </td>
                    </tr>
                }
            </table>

            <table>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Type:<br />
                        @Html.DropDownList("ddlExpansionJointDamageType", (List<SelectListItem>)TempData["DamageType12"])
                    </td>
                </tr>
                <tr>
                    <td style="width: 150px" class="form-group form-group-sm">
                        Damage Level:<br />
                        @Html.DropDownList("ddlExpansionJointDamageLevel", (List<SelectListItem>)ViewBag.DamageSeverity)
                    </td>
                </tr>
                <tr>
                    <td style="width: 200px">
                        <br />
                        <button type="button" id="btnSaveExpansionJointDamage" class="btn btn-primary"><span class="glyphicon glyphicon-save"></span> Save</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>

@*<div id="status"></div>*@

<script type="text/javascript">
    $(document).ready(function () {
        makeDamageLevelEditable();
        makePavementDamageEditable();
        makeCurbAndRailingDamageEditable();
        makeDrainageDamageEditable();
        makeBearingDamageEditable();
        makeExpansionJointDamageEditable();

        // A function that makes "DamageLevel" editable
        function makeDamageLevelEditable() {
            $(".damage-severity").each(function () {
                var selVisualInspId = $(this).attr("name");
                $(this).editable("/DamageInspVisual/UpdateDamageSeverity", {
                    type: "select",
                    loadurl: '/DamageInspVisual/SelectDamageSeverity',
                    callback: function (value, settings) {
                        $(this).html(jQuery.parseJSON(settings.data)[value]);
                    },
                    submitdata: function () {
                        return {
                            id: selVisualInspId,
                            @*inspdate: '@TempData["InspectionDate"]'*@
                        };
                    },
                    tooltip: 'Click me...',
                    indicator: 'Saving...',
                    size: 10
                });
            });
        }

        // A function that makes Pavement "DamageType" editable
        function makePavementDamageEditable() {
            $(".damage-type-pavement").each(function () {
                var selVisualInspId = $(this).attr("name");
                $(this).editable('/DamageInspVisual/UpdateDamageType', {
                    type: "select",
                    loadurl: '/DamageInspVisual/SelectDamageTypePavement',
                    callback: function (value, settings) {
                        $(this).html(jQuery.parseJSON(settings.data)[value]);
                    },
                    submitdata: function () {
                        return {
                            id: selVisualInspId,
                            @*inspdate: '@TempData["InspectionDate"]'*@
                        };
                    },
                    tooltip: 'Click/Tap to edit...',
                    indicator: 'Saving...'
                });
            });
        }

        // A function that makes Curb and Railing "DamageType" editable
        function makeCurbAndRailingDamageEditable() {
            $(".damage-type-curbandrailing").each(function () {
                var selVisualInspId = $(this).attr("name");
                $(this).editable('/DamageInspVisual/UpdateDamageType', {
                    type: "select",
                    loadurl: '/DamageInspVisual/SelectDamageTypeCurbAndRailing',
                    callback: function (value, settings) {
                        $(this).html(jQuery.parseJSON(settings.data)[value]);
                    },
                    submitdata: function () {
                        return {
                            id: selVisualInspId,
                            @*inspdate: '@TempData["InspectionDate"]'*@
                        };
                    },
                    tooltip: 'Click/Tap to edit...',
                    indicator: 'Saving...'
                });
            });
        }

        // A function that makes Drainage "DamageType" editable
        function makeDrainageDamageEditable() {
            $(".damage-type-drainage").each(function () {
                var selVisualInspId = $(this).attr("name");
                $(this).editable('/DamageInspVisual/UpdateDamageType', {
                    type: "select",
                    loadurl: '/DamageInspVisual/SelectDamageTypeDrainage',
                    callback: function (value, settings) {
                        $(this).html(jQuery.parseJSON(settings.data)[value]);
                    },
                    submitdata: function () {
                        return {
                            id: selVisualInspId,
                            @*inspdate: '@TempData["InspectionDate"]'*@
                        };
                    },
                    tooltip: 'Click/Tap to edit...',
                    indicator: 'Saving...'
                });
            });
        }

        // A function that makes Bearing "DamageType" editable
        function makeBearingDamageEditable() {
            $(".damage-type-bearing").each(function () {
                var selVisualInspId = $(this).attr("name");
                $(this).editable('/DamageInspVisual/UpdateDamageType', {
                    type: "select",
                    loadurl: '/DamageInspVisual/SelectDamageTypeBearing',
                    callback: function (value, settings) {
                        $(this).html(jQuery.parseJSON(settings.data)[value]);
                    },
                    submitdata: function () {
                        return {
                            id: selVisualInspId,
                            @*inspdate: '@TempData["InspectionDate"]'*@
                        };
                    },
                    tooltip: 'Click/Tap to edit...',
                    indicator: 'Saving...'
                });
            });
        }

        // A function that makes Expansion Joint "DamageType" editable
        function makeExpansionJointDamageEditable() {
            $(".damage-type-expansionjoint").each(function () {
                var selVisualInspId = $(this).attr("name");
                $(this).editable('/DamageInspVisual/UpdateDamageType', {
                    type: "select",
                    loadurl: '/DamageInspVisual/SelectDamageTypeExpansionJoint',
                    callback: function (value, settings) {
                        $(this).html(jQuery.parseJSON(settings.data)[value]);
                    },
                    submitdata: function () {
                        return {
                            id: selVisualInspId,
                            @*inspdate: '@TempData["InspectionDate"]'*@
                        };
                    },
                    tooltip: 'Click/Tap to edit...',
                    indicator: 'Saving...'
                });
            });
        }

        //Save Pavement Damage
        $("#btnSavePavementDamage").on("click", function () {
            var BridgeId = $("#bridgeId");
            var InspectionDate = $("#inspectionDate");
            var PavementDamageType = $("#ddlPavementDamageType");
            var PavementDamageLevel = $("#ddlPavementDamageLevel");
            var InspType = 1;
            var StructItem = 8;
            //alert('{BridgeId: "' + BridgeId.val() + '", StructureItemId: ' + StructItem + ', DamageTypeId: ' + PavementDamageType.val() + ', DamageSeverityId: ' + PavementDamageLevel.val() + ', InspectionTypeId: ' + InspType + ', InspectionDate: "' + InspectionDate.val() + '" }');
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SaveDamage", "DamageInspVisual")',
                data: '{BridgeId: "' + BridgeId.val() + '", StructureItemId: ' + StructItem + ', DamageTypeId: ' + PavementDamageType.val() + ', DamageSeverityId: ' + PavementDamageLevel.val() + ', InspectionTypeId: ' + InspType + ', InspectionDate: "' + InspectionDate.val() + '" }',
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Action("GetLastAddedDamage", "DamageInspVisual")',
                        data: { bridgeid: BridgeId.val() },
                        datatype: 'json',
                        success: function (data) {
                            var Id = data.Id;
                            var row = '<tr>';
                            row += '<td><input type="hidden" id="PavementId" value="' + Id + '" /></td>';
                            row += '<td><span class="damage-type-pavement" name="' + Id + '">' + $('#ddlPavementDamageType option:selected').text() + '</span></td>';
                            row += '<td><span class="damage-severity" name="' + Id + '">' + $('#ddlPavementDamageLevel option:selected').text() + '</span></td>';
                            row += '<td><a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a></td>';
                            row += '<td><a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>'
                                + '<a class="Delete glyphicon glyphicon-trash" href = "javascript:;" data - toggle="tooltip" title = "Delete" ></a ></td>';
                            row += '</tr > ';
                            $("#tblPavement > tbody").append(row);
                            makePavementDamageEditable();
                            //alert(row);
                            makeDamageLevelEditable();
                            $('#ddlPavementDamageType').val("");
                            $('#ddlPavementDamageLevel').val("");
                        },
                        error: function (xhr) {
                            //$('#status').text(xhr.status);
                        }
                    });
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Cancel Pavement damage
        $("body").on("click", "#tblPavement .Cancel", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {
                if ($(this).find("input").length > 0) {
                    var span = $(this).find("span");
                    var input = $(this).find("input");
                    input.val(span.html());
                    span.show();
                    input.hide();
                }
            });
            row.find(".Delete").show();
            row.find(".Confirm").hide();
            $(this).hide();
        });

        //Delete Pavement damage
        $("body").on("click", "#tblPavement .Delete", function () {
            var row = $(this).closest("tr");
            row.find(".Confirm").show();
            row.find(".Cancel").show();
            row.find(".Delete").hide();
            $(this).hide();
        });

        //Confirm Pavement damage
        $("body").on("click", "#tblPavement .Confirm", function () {
            var row = $(this).closest("tr");
            var id = row.find('#PavementId').val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteDamage", "DamageInspVisual")',
                data: '{id: "' + id + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                success: function (response) {
                    if ($("#tblPavement tr").length > 2) {
                        row.remove();

                    } else {
                        row.find(".Delete").hide();
                        row.find(".Confirm").hide();
                        row.find(".Cancel").hide();
                        row.find("span").html('&nbsp;');
                    }
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Save Curb and Railing Damage
        $("#btnSaveCurbAndRailingDamage").on("click", function () {
            var BridgeId = $("#bridgeId");
            var InspectionDate = $("#inspectionDate");
            var CurbAndRailingDamageType = $("#ddlCurbAndRailingDamageType");
            var CurbAndRailingDamageLevel = $("#ddlCurbAndRailingDamageLevel");
            var InspType = 1;
            var StructItem = 9;
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SaveDamage", "DamageInspVisual")',
                data: '{BridgeId: "' + BridgeId.val() + '", StructureItemId: ' + StructItem + ', DamageTypeId: ' + CurbAndRailingDamageType.val() + ', DamageSeverityId: ' + CurbAndRailingDamageLevel.val() + ', InspectionTypeId: ' + InspType + ', InspectionDate: "' + InspectionDate.val() + '" }',
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Action("GetLastAddedDamage", "DamageInspVisual")',
                        data: { bridgeid: BridgeId.val() },
                        datatype: 'json',
                        success: function (data) {
                            var Id = data.Id;
                            var row = '<tr>';
                            row += '<td><input type="hidden" id="CurbAndRailingId" value="' + Id + '" /></td>';
                            row += '<td><span class="damage-type-curbandrailing" name="' + Id + '">' + $('#ddlCurbAndRailingDamageType option:selected').text() + '</span></td>';
                            row += '<td><span class="damage-severity" name="' + Id + '">' + $('#ddlCurbAndRailingDamageLevel option:selected').text() + '</span></td>';
                            row += '<td><a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a></td>';
                            row += '<td><a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>'
                                + '<a class="Delete glyphicon glyphicon-trash" href = "javascript:;" data - toggle="tooltip" title = "Delete" ></a ></td>';
                            row += '</tr > ';
                            //alert(row);
                            $("#tblCurbAndRailing > tbody").append(row);
                            makeCurbAndRailingDamageEditable();
                            makeDamageLevelEditable();
                            $('#ddlCurbAndRailingDamageType').val("");
                            $('#ddlCurbAndRailingDamageLevel').val("");
                        },
                        error: function (xhr) {
                            //$('#status').text(xhr.status);
                        }
                    });
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Cancel Curb and Railing damage
        $("body").on("click", "#tblCurbAndRailing .Cancel", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {
                if ($(this).find("input").length > 0) {
                    var span = $(this).find("span");
                    var input = $(this).find("input");
                    input.val(span.html());
                    span.show();
                    input.hide();
                }
            });
            row.find(".Delete").show();
            row.find(".Confirm").hide();
            $(this).hide();
        });

        //Delete Curb and Railing damage
        $("body").on("click", "#tblCurbAndRailing .Delete", function () {
            var row = $(this).closest("tr");
            row.find(".Confirm").show();
            row.find(".Cancel").show();
            row.find(".Delete").hide();
            $(this).hide();
        });

        //Confirm Curb and Railing damage
        $("body").on("click", "#tblCurbAndRailing .Confirm", function () {
            var row = $(this).closest("tr");
            var id = row.find('#CurbAndRailingId').val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteDamage", "DamageInspVisual")',
                data: '{id: "' + id + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                success: function (response) {
                    if ($("#tblCurbAndRailing tr").length > 2) {
                        row.remove();

                    } else {
                        row.find(".Delete").hide();
                        row.find(".Confirm").hide();
                        row.find(".Cancel").hide();
                        row.find("span").html('&nbsp;');
                    }
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Save Drainage Damage
        $("#btnSaveDrainageDamage").on("click", function () {
            var BridgeId = $("#bridgeId");
            var InspectionDate = $("#inspectionDate");
            var DrainageDamageType = $("#ddlDrainageDamageType");
            var DrainageDamageLevel = $("#ddlDrainageDamageLevel");
            var InspType = 1;
            var StructItem = 10;
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SaveDamage", "DamageInspVisual")',
                data: '{BridgeId: "' + BridgeId.val() + '", StructureItemId: ' + StructItem + ', DamageTypeId: ' + DrainageDamageType.val() + ', DamageSeverityId: ' + DrainageDamageLevel.val() + ', InspectionTypeId: ' + InspType + ', InspectionDate: "' + InspectionDate.val() + '" }',
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Action("GetLastAddedDamage", "DamageInspVisual")',
                        data: { bridgeid: BridgeId.val() },
                        datatype: 'json',
                        success: function (data) {
                            var Id = data.Id;
                            var row = '<tr>';
                            row += '<td><input type="hidden" id="DrainageId" value="' + Id + '" /></td>';
                            row += '<td><span class="damage-type-drainage" name="' + Id + '">' + $('#ddlDrainageDamageType option:selected').text() + '</span></td>';
                            row += '<td><span class="damage-severity" name="' + Id + '">' + $('#ddlDrainageDamageLevel option:selected').text() + '</span></td>';
                            row += '<td><a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a></td>';
                            row += '<td><a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>'
                                + '<a class="Delete glyphicon glyphicon-trash" href = "javascript:;" data - toggle="tooltip" title = "Delete" ></a ></td>';
                            row += '</tr > ';
                            //alert(row);
                            $("#tblDrainage > tbody").append(row);
                            makeDrainageDamageEditable();
                            makeDamageLevelEditable();
                            $('#ddlDrainageDamageType').val("");
                            $('#ddlDrainageDamageLevel').val("");
                        },
                        error: function (xhr) {
                            //$('#status').text(xhr.status);
                        }
                    });
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Cancel Drainage damage
        $("body").on("click", "#tblDrainage .Cancel", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {
                if ($(this).find("input").length > 0) {
                    var span = $(this).find("span");
                    var input = $(this).find("input");
                    input.val(span.html());
                    span.show();
                    input.hide();
                }
            });
            row.find(".Delete").show();
            row.find(".Confirm").hide();
            $(this).hide();
        });

        //Delete Drainage damage
        $("body").on("click", "#tblDrainage .Delete", function () {
            var row = $(this).closest("tr");
            row.find(".Confirm").show();
            row.find(".Cancel").show();
            row.find(".Delete").hide();
            $(this).hide();
        });

        //Confirm Drainage damage
        $("body").on("click", "#tblDrainage .Confirm", function () {
            var row = $(this).closest("tr");
            var id = row.find('#DrainageId').val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteDamage", "DamageInspVisual")',
                data: '{id: "' + id + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                success: function (response) {
                    if ($("#tblDrainage tr").length > 2) {
                        row.remove();

                    } else {
                        row.find(".Delete").hide();
                        row.find(".Confirm").hide();
                        row.find(".Cancel").hide();
                        row.find("span").html('&nbsp;');
                    }
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Save Bearing Damage
        $("#btnSaveBearingDamage").on("click", function () {
            var BridgeId = $("#bridgeId");
            var InspectionDate = $("#inspectionDate");
            var BearingDamageType = $("#ddlBearingDamageType");
            var BearingDamageLevel = $("#ddlBearingDamageLevel");
            var InspType = 1;
            var StructItem = 11;
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SaveDamage", "DamageInspVisual")',
                data: '{BridgeId: "' + BridgeId.val() + '", StructureItemId: ' + StructItem + ', DamageTypeId: ' + BearingDamageType.val() + ', DamageSeverityId: ' + BearingDamageLevel.val() + ', InspectionTypeId: ' + InspType + ', InspectionDate: "' + InspectionDate.val() + '" }',
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Action("GetLastAddedDamage", "DamageInspVisual")',
                        data: { bridgeid: BridgeId.val() },
                        datatype: 'json',
                        success: function (data) {
                            var Id = data.Id;
                            var row = '<tr>';
                            row += '<td><input type="hidden" id="BearingId" value="' + Id + '" /></td>';
                            row += '<td><span class="damage-type-bearing" name="' + Id + '">' + $('#ddlBearingDamageType option:selected').text() + '</span></td>';
                            row += '<td><span class="damage-severity" name="' + Id + '">' + $('#ddlBearingDamageLevel option:selected').text() + '</span></td>';
                            row += '<td><a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a></td>';
                            row += '<td><a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>'
                                + '<a class="Delete glyphicon glyphicon-trash" href = "javascript:;" data - toggle="tooltip" title = "Delete" ></a ></td>';
                            row += '</tr > ';
                            //alert(row);
                            $("#tblBearing > tbody").append(row);
                            makeBearingDamageEditable();
                            makeDamageLevelEditable();
                            $('#ddlBearingDamageType').val("");
                            $('#ddlBearingDamageLevel').val("");
                        },
                        error: function (xhr) {
                            //$('#status').text(xhr.status);
                        }
                    });
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Cancel Bearing damage
        $("body").on("click", "#tblBearing .Cancel", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {
                if ($(this).find("input").length > 0) {
                    var span = $(this).find("span");
                    var input = $(this).find("input");
                    input.val(span.html());
                    span.show();
                    input.hide();
                }
            });
            row.find(".Delete").show();
            row.find(".Confirm").hide();
            $(this).hide();
        });

        //Delete Bearing damage
        $("body").on("click", "#tblBearing .Delete", function () {
            var row = $(this).closest("tr");
            row.find(".Confirm").show();
            row.find(".Cancel").show();
            row.find(".Delete").hide();
            $(this).hide();
        });

        //Confirm Bearing damage
        $("body").on("click", "#tblBearing .Confirm", function () {
            var row = $(this).closest("tr");
            var id = row.find('#BearingId').val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteDamage", "DamageInspVisual")',
                data: '{id: "' + id + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                success: function (response) {
                    if ($("#tblBearing tr").length > 2) {
                        row.remove();

                    } else {
                        row.find(".Delete").hide();
                        row.find(".Confirm").hide();
                        row.find(".Cancel").hide();
                        row.find("span").html('&nbsp;');
                    }
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Save Expansion Joint Damage
        $("#btnSaveExpansionJointDamage").on("click", function () {
            var BridgeId = $("#bridgeId");
            var InspectionDate = $("#inspectionDate");
            var ExpansionJointDamageType = $("#ddlExpansionJointDamageType");
            var ExpansionJointDamageLevel = $("#ddlExpansionJointDamageLevel");
            var InspType = 1;
            var StructItem = 12;
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SaveDamage", "DamageInspVisual")',
                data: '{BridgeId: "' + BridgeId.val() + '", StructureItemId: ' + StructItem + ', DamageTypeId: ' + ExpansionJointDamageType.val() + ', DamageSeverityId: ' + ExpansionJointDamageLevel.val() + ', InspectionTypeId: ' + InspType + ', InspectionDate: "' + InspectionDate.val() + '" }',
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Action("GetLastAddedDamage", "DamageInspVisual")',
                        data: { bridgeid: BridgeId.val() },
                        datatype: 'json',
                        success: function (data) {
                            var Id = data.Id;
                            var row = '<tr>';
                            row += '<td><input type="hidden" id="ExpansionJointId" value="' + Id + '" /></td>';
                            row += '<td><span class="damage-type-expansionjoint" name="' + Id + '">' + $('#ddlExpansionJointDamageType option:selected').text() + '</span></td>';
                            row += '<td><span class="damage-severity" name="' + Id + '">' + $('#ddlExpansionJointDamageLevel option:selected').text() + '</span></td>';
                            row += '<td><a class="Confirm glyphicon glyphicon-ok" href="javascript:;" style="display:none" data-toggle="tooltip" title="Confirm"></a></td>';
                            row += '<td><a class="Cancel glyphicon glyphicon-remove" href="javascript:;" style="display:none" data-toggle="tooltip" title="Cancel"></a>'
                                + '<a class="Delete glyphicon glyphicon-trash" href = "javascript:;" data - toggle="tooltip" title = "Delete" ></a ></td>';
                            row += '</tr > ';
                            //alert(row);
                            $("#tblExpansionJoint > tbody").append(row);
                            makeExpansionJointDamageEditable();
                            makeDamageLevelEditable();
                            $('#ddlExpansionJointDamageType').val("");
                            $('#ddlExpansionJointDamageLevel').val("");
                        },
                        error: function (xhr) {
                            //$('#status').text(xhr.status);
                        }
                    });
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });

        //Cancel Expansion Joint damage
        $("body").on("click", "#tblExpansionJoint .Cancel", function () {
            var row = $(this).closest("tr");
            $("td", row).each(function () {
                if ($(this).find("input").length > 0) {
                    var span = $(this).find("span");
                    var input = $(this).find("input");
                    input.val(span.html());
                    span.show();
                    input.hide();
                }
            });
            row.find(".Delete").show();
            row.find(".Confirm").hide();
            $(this).hide();
        });

        //Delete Expansion Joint damage
        $("body").on("click", "#tblExpansionJoint .Delete", function () {
            var row = $(this).closest("tr");
            row.find(".Confirm").show();
            row.find(".Cancel").show();
            row.find(".Delete").hide();
            $(this).hide();
        });

        //Confirm Expansion Joint damage
        $("body").on("click", "#tblExpansionJoint .Confirm", function () {
            var row = $(this).closest("tr");
            var id = row.find('#ExpansionJointId').val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteDamage", "DamageInspVisual")',
                data: '{id: "' + id + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                success: function (response) {
                    if ($("#tblExpansionJoint tr").length > 2) {
                        row.remove();

                    } else {
                        row.find(".Delete").hide();
                        row.find(".Confirm").hide();
                        row.find(".Cancel").hide();
                        row.find("span").html('&nbsp;');
                    }
                },
                error: function (xhr) {
                    //$('#status').text(xhr.status);
                }
            });
        });
    });
</script>
