@model ERA_BMS.ViewModels.InspMajorAncillariesViewModel

<!--Change TempData to ViewBag for easy use-->
@{
    ViewBag.PavementDamageTypeList = (List<string[]>)TempData["PavementDamageTypeList"];
    ViewBag.CurbAndRailingDamageTypeList = (List<string[]>)TempData["CurbAndRailingDamageTypeList"];
    ViewBag.DrainageDamageTypeList = (List<string[]>)TempData["DrainageDamageTypeList"];
    ViewBag.BearingDamageTypeList = (List<string[]>)TempData["BearingDamageTypeList"];
    ViewBag.ExpansionJointDamageTypeList = (List<string[]>)TempData["ExpansionJointDamageTypeList"];

    ViewBag.DamageRankList = (List<string>)TempData["DamageRankList"];
}

<input type="hidden" id="bridgeId" value="@ViewBag.BridgeId" /> <!-- Bridge Id -->
<input type="hidden" id="inspectionYear" value="@ViewBag.InspectionYear" /> <!-- Inspection Year -->
<input type="hidden" id="inspectionDate" value="@ViewBag.InspectionDate" /> <!-- Inspection Date -->
<div class="row">
    <div class="panel panel-default col-lg-15 col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-1">
            <h5 class="panel-title panel-info" style="text-align: center">Pavement</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblPavement" style="border: 1px solid black;">
                <tr id="heading-1">
                    <th></th>
                    <th>DamageType</th>
                    <th>A+</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                </tr>
                @for (int i = 0; i < ViewBag.PavementDamageTypeList.Count; i++)
                {
                    @: <tr>
                        <td></td>
                        <td>
                            @ViewBag.PavementDamageTypeList[i][1]
                        </td>
                        for (int j = 0; j < ViewBag.DamageRankList.Count; j++)
                        {
                            // set default values
                            float damageArea = 0;
                            string damageid = "-1";
                            string fontStyle = "";

                            foreach (var item in Model.Pavement)
                            {
                                if (ViewBag.DamageRankList[j] == item.DamageRank.DamageRankName && ViewBag.PavementDamageTypeList[i][0] == item.DamageTypeId.ToString())
                                {
                                    damageArea = (float)item.DamageArea;
                                    damageid = item.Id;
                                    fontStyle = "color:red;font-weight: bold;";
                                }
                            }
                            @: <td><span class="damage-rank" name="@damageid" data-damagetype="@ViewBag.PavementDamageTypeList[i][0]" data-damagerank="@ViewBag.DamageRankList[j]" data-structureitem="8" style="@fontStyle">@damageArea</span></td>
                        }
                    @: </tr>
                }
            </table>
        </div>
    </div>

    <div class="panel panel-default col-lg-15 col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-2">
            <h5 class="panel-title panel-info" style="text-align: center">Curb and Railing</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblCurbAndRailing" style="border: 1px solid black;">
                <tr id="heading-2">
                    <th></th>
                    <th>DamageType</th>
                    <th>A+</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                </tr>
                @{

                    for (int i = 0; i < ViewBag.CurbAndRailingDamageTypeList.Count; i++)
                    {
                        @: <tr>
                            <td></td>
                            <td>
                                @ViewBag.CurbAndRailingDamageTypeList[i][1]
                            </td>

                            for (int j = 0; j < ViewBag.DamageRankList.Count; j++)
                            {
                                // set default values
                                float damageArea = 0;
                                string damageid = "-1";
                                string fontStyle = "";

                                foreach (var item in Model.CurbAndRailing)
                                {
                                    if (ViewBag.DamageRankList[j] == item.DamageRank.DamageRankName && ViewBag.CurbAndRailingDamageTypeList[i][0] == item.DamageTypeId.ToString())
                                    {
                                        damageArea = (float)item.DamageArea;
                                        damageid = item.Id;
                                        fontStyle = "color:red;font-weight: bold;";
                                    }
                                }
                                @: <td><span class="damage-rank" name="@damageid" data-damagetype="@ViewBag.CurbAndRailingDamageTypeList[i][0]" data-damagerank="@ViewBag.DamageRankList[j]" data-structureitem="9" style="@fontStyle">@damageArea</span></td>
                            }
                        @: </tr>
                    }
                }
            </table>
        </div>
    </div>

    <div class="clearfix visible-xs"></div> <!-- Add clearfix (or new line break) for only the xs -->

    <div class="panel panel-default col-lg-15 col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-1">
            <h5 class="panel-title panel-info" style="text-align: center">Drainage</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblDrainage" style="border: 1px solid black;">
                <tr id="heading-1">
                    <th></th>
                    <th>DamageType</th>
                    <th>A+</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                </tr>

                @for (int i = 0; i < ViewBag.DrainageDamageTypeList.Count; i++)
                {
                    @: <tr>
                        <td></td>
                        <td>
                            @ViewBag.DrainageDamageTypeList[i][1]
                        </td>
                        for (int j = 0; j < ViewBag.DamageRankList.Count; j++)
                        {
                            // set default values
                            float damageArea = 0;
                            string damageid = "-1";
                            string fontStyle = "";

                            foreach (var item in Model.Drainage)
                            {
                                if (ViewBag.DamageRankList[j] == item.DamageRank.DamageRankName && ViewBag.DrainageDamageTypeList[i][0] == item.DamageTypeId.ToString())
                                {
                                    damageArea = (float)item.DamageArea;
                                    damageid = item.Id;
                                    fontStyle = "color:red;font-weight: bold;";
                                }
                            }
                            @: <td><span class="damage-rank" name="@damageid" data-damagetype="@ViewBag.DrainageDamageTypeList[i][0]" data-damagerank="@ViewBag.DamageRankList[j]" data-structureitem="10" style="@fontStyle">@damageArea</span></td>
                        }
                    @: </tr>
                }
            </table>
        </div>
    </div>

    <div class="clearfix visible-sm"></div> <!-- Add clearfix (or new line break) for only the sm -->

    <div class="panel panel-default col-lg-15 col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-2">
            <h5 class="panel-title panel-info" style="text-align: center">Bearing</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblBearing" style="border: 1px solid black;">
                <tr id="heading-2">
                    <th></th>
                    <th>DamageType</th>
                    <th>A+</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                </tr>

                @for (int i = 0; i < ViewBag.BearingDamageTypeList.Count; i++)
                {
                    @: <tr>
                        <td></td>
                        <td>
                            @ViewBag.BearingDamageTypeList[i][1]
                        </td>
                        for (int j = 0; j < ViewBag.DamageRankList.Count; j++)
                        {
                            // set default values
                            float damageArea = 0;
                            string damageid = "-1";
                            string fontStyle = "";

                            foreach (var item in Model.Bearing)
                            {
                                if (ViewBag.DamageRankList[j] == item.DamageRank.DamageRankName && ViewBag.BearingDamageTypeList[i][0] == item.DamageTypeId.ToString())
                                {
                                    damageArea = (float)item.DamageArea;
                                    damageid = item.Id;
                                    fontStyle = "color:red;font-weight: bold;";
                                }
                            }
                            @: <td><span class="damage-rank" name="@damageid" data-damagetype="@ViewBag.BearingDamageTypeList[i][0]" data-damagerank="@ViewBag.DamageRankList[j]" data-structureitem="11" style="@fontStyle">@damageArea</span></td>
                        }
                    @: </tr>
                }
            </table>
        </div>
    </div>

    <div class="clearfix visible-md"></div> <!-- Add clearfix (or new line break) for only the md -->
    <div class="clearfix visible-xs"></div> <!-- Add clearfix (or new line break) for only the xs -->

    <div class="panel panel-default col-lg-15 col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-1">
            <h5 class="panel-title panel-info" style="text-align: center">Expansion Joint</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblExpansionJoint" style="border: 1px solid black;">
                <tr id="heading-1">
                    <th></th>
                    <th>DamageType</th>
                    <th>A+</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                </tr>

                @for (int i = 0; i < ViewBag.ExpansionJointDamageTypeList.Count; i++)
                {
                    @: <tr>
                        <td></td>
                        <td>
                            @ViewBag.ExpansionJointDamageTypeList[i][1]
                        </td>
                        for (int j = 0; j < ViewBag.DamageRankList.Count; j++)
                        {
                            // set default values
                            float damageArea = 0;
                            string damageid = "-1";
                            string fontStyle = "";

                            foreach (var item in Model.ExpansionJoint)
                            {
                                if (ViewBag.DamageRankList[j] == item.DamageRank.DamageRankName && ViewBag.ExpansionJointDamageTypeList[i][0] == item.DamageTypeId.ToString())
                                {
                                    damageArea = (float)item.DamageArea;
                                    damageid = item.Id;
                                    fontStyle = "color:red;font-weight: bold;";
                                }
                            }
                            @: <td><span class="damage-rank" name="@damageid" data-damagetype="@ViewBag.ExpansionJointDamageTypeList[i][0]" data-damagerank="@ViewBag.DamageRankList[j]" data-structureitem="12" style="@fontStyle">@damageArea</span></td>
                        }
                    @: </tr>
                }
            </table>
        </div>
    </div>
</div>

@*<div id="status"></div>*@

<script type="text/javascript">
    $(document).ready(function () {
        // Makes "Damage Rank" editable
        $(".damage-rank").each(function () {
            $(this).editable("/DamageInspMajor/UpdateDamageData", {
                callback: function (value, settings) {
                    // If area is other than 0, set the font style to red and bold
                    if (value != "0") {
                        $(this).css({ 'color': 'red', 'font-weight': 'bold' });
                        $(this).attr("name", $('#bridgeId').val());
                    }
                    else {
                        $(this).css({ 'color': '', 'font-weight': '' });
                        $(this).attr("name", "-1");
                    }
                },
                submitdata: function () {
                    return {
                        // Pass parameters to "UpdateDamageData" controller action
                        id: $(this).attr("name"),
                        origvalue: this.revert,
                        bridgeid: $('#bridgeId').val(),
                        inspyear: $('#inspectionYear').val(),
                        inspdate: $('#inspectionDate').val(),
                        stritemid: $(this).attr("data-structureitem"),
                        dmgtypeid: $(this).attr("data-damagetype"),
                        dmgrank: $(this).attr("data-damagerank")
                    };
                },
                tooltip: 'Click/Tap to edit...',
                indicator: 'Saving...',
                select: true, // highlight all text after editable
                size: 1
            });
        });
    });
</script>
