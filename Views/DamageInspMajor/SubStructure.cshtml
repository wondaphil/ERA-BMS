@model ERA_BMS.ViewModels.InspMajorSubStructuresViewModel

<!--Change TempData to ViewBag for easy use-->
@{
    ViewBag.PierDamageTypeList = (List<string[]>)TempData["PierDamageTypeList"];
    ViewBag.AbutmentDamageTypeList = (List<string[]>)TempData["AbutmentDamageTypeList"];
    ViewBag.EmbankmentDamageTypeList = (List<string[]>)TempData["EmbankmentDamageTypeList"];
    ViewBag.RipRapDamageTypeList = (List<string[]>)TempData["RipRapDamageTypeList"];

    ViewBag.DamageRankList = (List<string>)TempData["DamageRankList"];
    
}

<input type="hidden" id="bridgeId" value="@TempData["BridgeId"]" /> <!-- Bridge Id -->
<input type="hidden" id="inspectionYear" value="@TempData["InspectionYear"]" /> <!-- Inspection Year -->
<input type="hidden" id="inspectionDate" value="@TempData["InspectionDate"]" /> <!-- Inspection Date -->
<div class="row">
    <div class="panel panel-default panel-collapse col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-1">
            <h5 class="panel-title panel-primary" style="text-align: center">Pier and Foundation</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblPierAndFoundation" style="border: 1px solid black;">
                <tr id="heading-1">
                    <th></th>
                    <th>DamageType</th>
                    <th>A+</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                </tr>
                @for (int i = 0; i < ViewBag.PierDamageTypeList.Count; i++)
                {
                    @: <tr>
                        <td></td>
                        <td>
                            @ViewBag.PierDamageTypeList[i][1]
                        </td>
                        for (int j = 0; j < ViewBag.DamageRankList.Count; j++)
                        {
                            // set default values
                            float damageArea = 0;
                            string damageid = "-1";
                            string fontStyle = "";

                            foreach (var item in Model.PierAndFoundation)
                            {
                                if (ViewBag.DamageRankList[j] == item.DamageRank.DamageRankName && ViewBag.PierDamageTypeList[i][0] == item.DamageTypeId.ToString())
                                {
                                    damageArea = (float)item.DamageArea;
                                    damageid = item.Id;
                                    fontStyle = "color:red;font-weight: bold;";
                                }
                            }
                            @: <td><span class="damage-rank" name="@damageid" data-damagetype="@ViewBag.PierDamageTypeList[i][0]" data-damagerank="@ViewBag.DamageRankList[j]" data-structureitem="1" style="@fontStyle">@damageArea</span></td>
                        }
                    @: </tr>
                }
            </table>
        </div>
    </div>

    <div class="panel panel-default col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-2">
            <h5 class="panel-title panel-info" style="text-align: center">Abutment and Wing Wall</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblAbutmentAndWingWall" style="border: 1px solid black;">
                <tr id="heading-2">
                    <th></th>
                    <th>DamageType</th>
                    <th>A+</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                </tr>
                @{

                    for (int i = 0; i < ViewBag.AbutmentDamageTypeList.Count; i++)
                    {
                        @: <tr>
                            <td></td>
                            <td>
                                @ViewBag.AbutmentDamageTypeList[i][1]
                            </td>

                            for (int j = 0; j < ViewBag.DamageRankList.Count; j++)
                            {
                                // set default values
                                float damageArea = 0;
                                string damageid = "-1";
                                string fontStyle = "";

                                foreach (var item in Model.AbutmentAndWingWall)
                                {
                                    if (ViewBag.DamageRankList[j] == item.DamageRank.DamageRankName && ViewBag.AbutmentDamageTypeList[i][0] == item.DamageTypeId.ToString())
                                    {
                                        damageArea = (float)item.DamageArea;
                                        damageid = item.Id;
                                        fontStyle = "color:red;font-weight: bold;";
                                    }
                                }
                                @: <td><span class="damage-rank" name="@damageid" data-damagetype="@ViewBag.AbutmentDamageTypeList[i][0]" data-damagerank="@ViewBag.DamageRankList[j]" data-structureitem="2" style="@fontStyle">@damageArea</span></td>
                            }
                        @: </tr>
                    }
                }
            </table>
        </div>
    </div>

    <div class="panel panel-default col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-1">
            <h5 class="panel-title panel-info" style="text-align: center">Embankment</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblEmbankment" style="border: 1px solid black;">
                <tr id="heading-1">
                    <th></th>
                    <th>DamageType</th>
                    <th>A+</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                </tr>

                @for (int i = 0; i < ViewBag.EmbankmentDamageTypeList.Count; i++)
                {
                    @: <tr>
                        <td></td>
                        <td>
                            @ViewBag.EmbankmentDamageTypeList[i][1]
                        </td>
                        for (int j = 0; j < ViewBag.DamageRankList.Count; j++)
                        {
                            // set default values
                            float damageArea = 0;
                            string damageid = "-1";
                            
                            string fontStyle = "";

                            foreach (var item in Model.Embankment)
                            {
                                if (ViewBag.DamageRankList[j] == item.DamageRank.DamageRankName && ViewBag.EmbankmentDamageTypeList[i][0] == item.DamageTypeId.ToString())
                                {
                                    damageArea = (float)item.DamageArea;
                                    damageid = item.Id;
                                    fontStyle = "color:red;font-weight: bold;";
                                }
                            }
                            @: <td><span class="damage-rank" name="@damageid" data-damagetype="@ViewBag.EmbankmentDamageTypeList[i][0]" data-damagerank="@ViewBag.DamageRankList[j]" data-structureitem="3" style="@fontStyle">@damageArea</span></td>
                        }
                    @: </tr>
                }
            </table>
        </div>
    </div>

    <div class="panel panel-default col-md-3 col-sm-4 col-xs-6">
        <div class="panel-heading" id="heading-2">
            <h5 class="panel-title panel-info" style="text-align: center">Rip Rap</h5>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-condensed table-responsive small" id="tblRipRap" style="border: 1px solid black;">
                <tr id="heading-2">
                    <th></th>
                    <th>DamageType</th>
                    <th>A+</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                </tr>

                @for (int i = 0; i < ViewBag.RipRapDamageTypeList.Count; i++)
                {
                    @: <tr>
                        <td></td>
                        <td>
                            @ViewBag.RipRapDamageTypeList[i][1]
                        </td>
                    for (int j = 0; j < ViewBag.DamageRankList.Count; j++)
                    {
                        // set default values
                        float damageArea = 0;
                        string damageid = "-1";

                        string fontStyle = "";

                        foreach (var item in Model.RipRap)
                        {
                            if (ViewBag.DamageRankList[j] == item.DamageRank.DamageRankName && ViewBag.RipRapDamageTypeList[i][0] == item.DamageTypeId.ToString())
                            {
                                damageArea = (float)item.DamageArea;
                                damageid = item.Id;
                                fontStyle = "color:red;font-weight: bold;";
                            }
                        }
                            @: <td><span class="damage-rank" name="@damageid" data-damagetype="@ViewBag.RipRapDamageTypeList[i][0]" data-damagerank="@ViewBag.DamageRankList[j]" data-structureitem="4" style="@fontStyle">@damageArea</span></td>
                        }
                    @: </tr>
                }
            </table>
        </div>
    </div>
</div>

@*<div id="status"></div>*@

<script type="text/javascript">
    $(document).ready(function () {
        // Makes "Damage Rank" editable
        $(".damage-rank").each(function () {
            $(this).editable("/DamageInspMajor/UpdateDamageData", {
                callback: function (value, settings) {
                    // If area is other than 0, set the font style to red and bold
                    if (value != "0") {
                        $(this).css({ 'color': 'red', 'font-weight': 'bold' });
                        $(this).attr("name", $('#bridgeId').val());
                    }
                    else {
                        $(this).css({ 'color': '', 'font-weight': '' });
                        $(this).attr("name", "-1");
                    }
                },
                submitdata: function () {
                    var today = new Date().toJSON().slice(0, 10);
                    //alert($('#inspectionYear').val());
                    //alert($('#inspectionDate').val());
                    return {
                        // Pass parameters to "UpdateDamageData" controller action
                        id: $(this).attr("name"),
                        origvalue: this.revert,
                        bridgeid: $('#bridgeId').val(),
                        inspyear: $('#inspectionYear').val(),
                        inspdate: $('#inspectionDate').val(),
                        stritemid: $(this).attr("data-structureitem"),
                        dmgtypeid: $(this).attr("data-damagetype"),
                        dmgrank: $(this).attr("data-damagerank")
                    };
                },
                tooltip: 'Click/Tap to edit...',
                indicator: 'Saving...',
                select: true, // highlight all text after editable
                size: 1
            });
        });
    });
</script>
