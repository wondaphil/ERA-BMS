@model IEnumerable<ERA_BMS.Models.BridgeConditionAndRepairCostByDistrict>

<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title panel-info">Summary of Bridge <b>Service Condition</b> and <b>Repair Cost</b> (District: <b>All</b>, Inspection Year: <b>@ViewBag.InspectionYear)</b></h3>
    </div>

    <div class="panel-body">
        <br />
        <br />
        <table class="table table-striped table-bordered table-condensed table-responsive display compact hover" id="tblbridgeconditionandrepaircost">
            <thead>
                <tr>
                    <th rowspan="2">
                        @Html.DisplayNameFor(model => model.District)
                    </th>
                    <th></th>
                    <th colspan="4" style="text-align: center">
                        No. of Bridges by Service Conditions
                    </th>
                    <th rowspan="2">
                        Total Damage Repair Cost
                    </th>
                </tr>
            
                <tr>
                    <th></th>
                    <th>
                        @Html.DisplayNameFor(model => model.Good)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Fair)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Bad)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Total)
                    </th>


                </tr>
            
                @{ int totalGood = 0;
                    int totalFair = 0;
                    int totalBad = 0;
                    int totalBridge = 0;
                    double totalBudget = 0.0;
                }
                @foreach (var item in Model)
                {
                    <tr>
                        @{
                            float sum = (float)(item.Good + item.Fair + item.Bad);
                        }
                        <td>
                            <h5>@Html.DisplayFor(modelItem => item.District)</h5>
                        </td>
                        <td>
                            <br />
                            Total Bridge
                            <br /><br />
                            <i>Percentage</i>
                        </td>
                        <td>
                            <br />
                            @item.Good
                            @{
                                totalGood += (int)item.Good;
                            }
                            <br /><br />
                            @{
                                float goodPerc = ((float)item.Good / sum) * 100;
                            }
                            <i>@goodPerc.ToString("0.00")</i>
                        </td>
                        <td>
                            <br />
                            @item.Fair
                            @{
                                totalFair += (int)item.Fair;
                            }
                            <br /><br />
                            @{
                                float fairPerc = ((float)item.Fair / sum) * 100;
                            }
                            <i>@fairPerc.ToString("0.00")</i>
                        </td>
                        <td>
                            <br />
                            @item.Bad
                            @{
                                totalBad += (int)item.Bad;
                            }
                            <br /><br />
                            @{
                                float badPerc = ((float)item.Bad / sum) * 100;
                            }
                            <i>@badPerc.ToString("0.00")</i>
                        </td>
                        <td>
                            <br />
                            @item.Total
                            @{
                                totalBridge += (int)item.Total;
                            }
                        </td>
                        <td>
                            <br />
                            @item.RepairCost.ToString("#,0.00")
                            @{
                                totalBudget += (int)item.RepairCost;
                            }
                        </td>
                    </tr>
                }
                <tr>
                    <th><h5>Total</h5></th>
                    <th></th>
                    <th><h5><b>@totalGood.ToString("0,0")</b></h5></th>
                    <th><h5><b>@totalFair.ToString("0,0")</b></h5></th>
                    <th><h5><b>@totalBad.ToString("0,0")</b></h5></th>
                    <th><h5><b>@totalBridge.ToString("0,0")</b></h5></th>
                    <th><h5><b>@totalBudget.ToString("#,0.00")</b></h5></th>
                </tr>
            </thead>
        </table>
    </div>
    <div class="panel-footer">
        <h3 class="panel-title">Total No. of Districts: <b>@Model.Count()</b></h3>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#tblbridgeconditionandrepaircost').dataTable({
            paging: false,
            pageLength: 15,
            bLengthChange: true,
            scrollY: 400,
            
            searching: true,
            select: true,
            dom: 'lBfrtip',
            language: {
                "emptyTable": " "
            },
            bInfo: false,
            //buttons: ['copy', 'excel', 'pdf', 'print']
            buttons: [
                { extend: 'copy', className: 'btn btn-sm btn-primary' },
                { extend: 'excel', className: 'btn btn-sm btn-primary', text: 'Export Excel' },
                { extend: 'pdf', className: 'btn btn-sm btn-primary', text: 'Export PDF' },
                { extend: 'print', className: 'btn btn-sm btn-primary' }
            ]
        });
    });
</script>